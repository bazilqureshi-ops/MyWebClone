@using Emse.QMagic.DAL;
@using Emse.QMagic.WebTerminal.Helpers;
@{
    Layout = null; // We are not using a layout file for this view
    string LanguageCode = "EN";
    if (Session["MagicLanguage"] != null)
    {
        LanguageCode = Session["MagicLanguage"].ToString();
    }
    qmTerminal LoginTerminal = ViewBag.LoginTerminal;
    List<qmBranch> BranchList = ViewBag.BranchList;
    qmUser LoginUser = ViewBag.LoginUser;
    List<qmTransferRule> ServiceTransferList = ViewBag.ServiceTransferList;
    List<qmService> ServiceList = ViewBag.ServiceList;
    List<qmSegment> SegmentList = ViewBag.Segments;
    List<qmGenerateTicketRule> Rules = ViewBag.Rules;
    List<qmGenerateTicketItem> GenItems = ViewBag.GenItems;
    string Segments = ViewBag.Segments;

    qmTicket autofillticket = null;
    if (ViewBag.AutoFillTicket != null)
    {
        autofillticket = ViewBag.AutoFillTicket;
    }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilaQ Web Terminal</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.ico">
    <link href="~/Content/bilaq-theme.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
    <div id="TerminalLoadingMain" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <div class="terminal-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="~/assets/logo.png" alt="BilaQ Logo" class="sidebar-logo" />
                <h1 class="sidebar-title">BilaQ</h1>
            </div>
            <div class="user-info">
                <img src="@LoginUser.ProfilePicture" alt="User" class="user-avatar" />
                <div class="user-details">
                    <span class="user-name">@LoginUser.FullName</span>
                    <span class="terminal-name">@LoginTerminal.TerminalName</span>
                </div>
            </div>
            <nav class="action-buttons">
                <button id="callNextBtn" class="action-btn primary" onclick="NextCall();">
                    <i class="fas fa-phone-alt"></i> @Localization.Translate(LanguageCode, "NextCall")
                </button>
                <button id="callAgainBtn" class="action-btn" onclick="Recall();">
                    <i class="fas fa-redo-alt"></i> @Localization.Translate(LanguageCode, "CallAgain")
                </button>
                <div class="action-btn-group">
                    <button id="parkBtn" class="action-btn" onclick="Park();">
                        <i class="fas fa-pause"></i> @Localization.Translate(LanguageCode, "Park")
                    </button>
                    <button id="noshowBtn" class="action-btn danger" onclick="NoShowTicket();">
                        <i class="fas fa-user-slash"></i> @Localization.Translate(LanguageCode, "NoShow")
                    </button>
                </div>
                <button id="finishBtn" class="action-btn" onclick="CloseTicket();">
                    <i class="fas fa-check-circle"></i> @Localization.Translate(LanguageCode, "Finish")
                </button>
            </nav>
            <div class="sidebar-footer">
                <a href="#" class="logout-btn" onclick="LogoutRequest();">
                    <i class="fa fa-sign-out"></i> @Localization.Translate(LanguageCode, "Logout")
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div id="InfoBox" class="now-serving-card">
                <!-- "Now Serving" content will be loaded here by Terminal.js -->
            </div>

            <div class="tabs-container">
                <div class="tab-header">
                    <button class="tab-link active" onclick="SwitchTab('MyQueueContent')">@Localization.Translate(LanguageCode, "MyQueue")</button>
                    <button class="tab-link" onclick="SwitchTab('MyParkedContent')">@Localization.Translate(LanguageCode, "ParkedTickets")</button>
                    <button class="tab-link" onclick="SwitchTab('GenerateTicketContent')">@Localization.Translate(LanguageCode, "GenerateTicket")</button>
                </div>
                <div class="tab-content">
                    <div id="MyQueueContent" class="tab-pane active">
                        <!-- Waiting list table will be loaded here -->
                    </div>
                    <div id="MyParkedContent" class="tab-pane">
                        <!-- Parked list table will be loaded here -->
                    </div>
                    <div id="GenerateTicketContent" class="tab-pane">
                        <div class="generate-ticket-form">
                             <div class="form-group">
                                <label>@Localization.Translate(LanguageCode, "Service")</label>
                                <select id="ddlGenService" class="form-control" onchange="RuleChange();">
                                    @foreach (var item in ServiceList)
                                    {
                                        <option value="@item.ServiceID">@item.ServiceName</option>
                                    }
                                </select>
                            </div>
                            <div class="form-group">
                                <label>@Localization.Translate(LanguageCode, "Segment")</label>
                                <select id="ddlGenSegment" class="form-control">
                                    @foreach (var item in SegmentList)
                                    {
                                        <option value="@item.SegmentID">@item.SegmentName</option>
                                    }
                                </select>
                            </div>
                             <div class="form-group">
                                <button class="btn-submit" onclick="GenerateTicket()">@Localization.Translate(LanguageCode, "GenerateTicket")</button>
                            </div>
                        </div>
                        <div id="InfoGenerateTicket">
                            <!-- Generate ticket info will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="CallTicketModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>@Localization.Translate(LanguageCode, "CallTicket")</h2>
                <button class="close-btn" onclick="$('#CallTicketModal').hide()">&times;</button>
            </div>
            <div class="modal-body" id="CallTicketModalBody"></div>
        </div>
    </div>
    <div class="modal" id="ChangeCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>@Localization.Translate(LanguageCode, "TicketPreview")</h2>
                <button class="close-btn" onclick="$('#ChangeCustomerModal').hide()">&times;</button>
            </div>
            <div class="modal-body" id="ChangeCustomerModalBody"></div>
        </div>
    </div>
    <div class="modal" id="ViewCustomerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>@Localization.Translate(LanguageCode, "TicketPreview")</h2>
                <button class="close-btn" onclick="$('#ViewCustomerModal').hide()">&times;</button>
            </div>
            <div class="modal-body" id="ViewCustomerModalBody"></div>
        </div>
    </div>
    <div class="modal" id="MoreInformationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>@Localization.Translate(LanguageCode, "MoreInformation")</h2>
                <button class="close-btn" onclick="$('#MoreInformationModal').hide()">&times;</button>
            </div>
            <div class="modal-body" id="MoreInformationModalBody"></div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.signalr/2.4.3/jquery.signalR.min.js"></script>
    <script src="http://localhost/SignalR/Hubs"></script>
    <script src="~/Scripts/Terminal.js"></script>
    <script>
        var loginTerminalID = "@LoginTerminal.TerminalID";
        var loginUserID = "@LoginUser.UserID";
        var commasegment = "@Html.Raw(Json.Encode(Segments))";
        var SegmentList = commasegment.split(',');

        // Initial calls
        $(document).ready(function() {
            // Initial load of the "Now Serving" box
            $.get("/Terminal/InfoBox", { TicketID: 0, TerminalID: loginTerminalID }, function (data) {
                $("#InfoBox").html(data);
            });
        });
    </script>
</body>
</html>
